# Deployment Scripts - Schnellstart

## ğŸš€ Automatisches Setup auf frischem VPS

### Schritt 1: Projekt auf Server hochladen

**Option A: Mit Git (empfohlen)**
```bash
# Auf dem VPS
ssh root@deine-server-ip
mkdir -p /var/www
cd /var/www
git clone https://github.com/dein-username/CubaCuba.git
cd CubaCuba
```

**Option B: Mit SCP/SFTP**
```bash
# Von deinem lokalen Rechner
scp -r /pfad/zu/CubaCuba root@deine-server-ip:/var/www/
```

### Schritt 2: Setup-Script ausfÃ¼hren

```bash
# Auf dem VPS
cd /var/www/CubaCuba
chmod +x setup-vps.sh
sudo ./setup-vps.sh
```

Das Script installiert und konfiguriert automatisch:
- âœ… Node.js 22.x
- âœ… PostgreSQL Datenbank
- âœ… Nginx als Reverse Proxy
- âœ… PM2 Process Manager
- âœ… SSL mit Let's Encrypt (optional)
- âœ… Firewall (ufw)
- âœ… Fail2Ban (Brute-Force Schutz)
- âœ… Automatische Backups
- âœ… Alle Umgebungsvariablen

**Dauer:** Ca. 5-10 Minuten

---

## ğŸ”„ Updates deployen

Wenn du Code-Ã„nderungen auf den Server bringen mÃ¶chtest:

```bash
# Auf dem VPS
cd /var/www/CubaCuba
./update-vps.sh
```

Das Update-Script fÃ¼hrt automatisch durch:
1. âœ… Backup erstellen (DB + Code)
2. âœ… Git Pull
3. âœ… Dependencies aktualisieren (falls nÃ¶tig)
4. âœ… Datenbank-Migrationen (falls nÃ¶tig)
5. âœ… Projekt neu bauen
6. âœ… Zero-downtime Reload
7. âœ… Health Check

---

## ğŸ“š Manuelle Anleitung

FÃ¼r eine detaillierte Schritt-fÃ¼r-Schritt-Anleitung siehe [DEPLOYMENT.md](./DEPLOYMENT.md)

---

## ğŸ†˜ Troubleshooting

### App lÃ¤uft nicht

```bash
pm2 logs cubacuba        # Logs anzeigen
pm2 restart cubacuba     # App neustarten
pm2 status              # Status prÃ¼fen
```

### Nginx-Probleme

```bash
nginx -t                           # Konfiguration testen
systemctl status nginx             # Status prÃ¼fen
tail -f /var/log/nginx/error.log  # Error-Log anzeigen
```

### Datenbank-Probleme

```bash
systemctl status postgresql                        # PostgreSQL Status
sudo -u postgres psql -d cubacuba -c "\dt"        # Tabellen anzeigen
tail -f /var/log/postgresql/postgresql-*-main.log # Logs
```

### Rollback nach Update

```bash
cd /var/www/CubaCuba
git log --oneline -10                    # Letzte Commits anzeigen
git checkout <commit-hash>               # Zu altem Commit zurÃ¼ck
npm install
npm run build
pm2 reload cubacuba
```

---

## ğŸ“ Wichtige Dateien und Pfade

| Was | Wo |
|-----|-----|
| Projekt | `/var/www/CubaCuba` |
| .env Datei | `/var/www/CubaCuba/.env` |
| Credentials | `/root/cubacuba-credentials.txt` |
| Backups | `/root/backups/cubacuba/` |
| Nginx Config | `/etc/nginx/sites-available/cubacuba` |
| PM2 Logs | `~/.pm2/logs/` |
| Nginx Logs | `/var/log/nginx/` |

---

## ğŸ›¡ï¸ Sicherheit

Nach dem Setup:

1. **Credentials sichern**: Die Datei `/root/cubacuba-credentials.txt` enthÃ¤lt alle PasswÃ¶rter
2. **SSH absichern**: SSH-Keys einrichten, Password-Auth deaktivieren
3. **Firewall prÃ¼fen**: `ufw status`
4. **Updates aktivieren**: Automatische Security-Updates sind aktiv
5. **Backups testen**: Teste ein Backup-Restore

---

## ğŸ“Š Monitoring

```bash
# System-Ressourcen
htop

# PM2 Dashboard
pm2 monit

# App-Status
pm2 status

# Live-Logs
pm2 logs cubacuba --lines 100

# Nginx-Zugriffe
tail -f /var/log/nginx/access.log
```

---

## ğŸ’¾ Backups

### Automatisch
- TÃ¤glich um 2 Uhr nachts
- Aufbewahrung: 7 Tage
- Verzeichnis: `/root/backups/cubacuba/`

### Manuell
```bash
/usr/local/bin/backup-cubacuba
```

### Restore
```bash
# Backup-Datei anzeigen
ls -lh /root/backups/cubacuba/

# Restore
gunzip < /root/backups/cubacuba/cubacuba_TIMESTAMP.sql.gz | \
  sudo -u postgres psql -d cubacuba
```

---

## ğŸ”§ NÃ¼tzliche Befehle

```bash
# PM2
pm2 list                    # Alle Apps
pm2 logs cubacuba           # Logs
pm2 restart cubacuba        # Restart
pm2 reload cubacuba         # Zero-downtime reload
pm2 stop cubacuba           # Stoppen
pm2 start cubacuba          # Starten
pm2 delete cubacuba         # Entfernen
pm2 monit                   # Monitoring

# Nginx
nginx -t                    # Config testen
systemctl restart nginx     # Neustarten
systemctl status nginx      # Status

# PostgreSQL
sudo -u postgres psql -d cubacuba              # DB-Console
sudo systemctl restart postgresql              # Neustarten

# Logs
tail -f /var/log/nginx/error.log              # Nginx Errors
tail -f /var/log/nginx/access.log             # Nginx Access
pm2 logs cubacuba --lines 100                 # App Logs

# System
htop                       # Ressourcen
df -h                      # Speicher
free -h                    # RAM
ufw status                 # Firewall
```
